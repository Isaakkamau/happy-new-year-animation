(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const h of e)if(h.type==="childList")for(const r of h.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const h={};return e.integrity&&(h.integrity=e.integrity),e.referrerPolicy&&(h.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?h.credentials="include":e.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(e){if(e.ep)return;e.ep=!0;const h=i(e);fetch(e.href,h)}})();class p{constructor(t){this.canvas=t,this.reset(),this.y=Math.random()*t.height}reset(){this.x=Math.random()*this.canvas.width,this.y=0,this.speed=Math.random()*3+2,this.size=Math.random()*2+1,this.twinkle=Math.random()*Math.PI}update(){this.y+=this.speed,this.twinkle+=.1,this.y>this.canvas.height&&this.reset()}draw(t){const i=Math.abs(Math.sin(this.twinkle)),a=`rgb(${255*i}, ${255*i}, ${255*i})`;t.fillStyle=a,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill()}}function o(s){return`hsl(${s%1*360}, 100%, 50%)`}function w(s,t){const i=s.createLinearGradient(0,0,0,t);return i.addColorStop(0,"rgb(0, 0, 20)"),i.addColorStop(1,"rgb(20, 0, 40)"),i}class y{constructor(t,i,a,e){this.x=t,this.y=i,this.canvas=e,this.particleType=a;const h=Math.random()*Math.PI*2;this.speed=Math.random()*7+3,this.vx=Math.cos(h)*this.speed,this.vy=Math.sin(h)*this.speed,this.lifetime=Math.random()*40+40,this.maxLifetime=this.lifetime,this.size=Math.random()*2+2,this.color=this.generateColor()}generateColor(){return this.particleType==="rainbow"?o(Math.random()):`rgb(${Math.random()*55+200}, ${Math.random()*155+100}, ${Math.random()*155+100})`}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.15,this.lifetime--,this.particleType==="rainbow"&&(this.color=o(this.x/this.canvas.width+this.y/this.canvas.height))}draw(t){if(this.lifetime>0){const i=this.lifetime/this.maxLifetime;if(t.fillStyle=this.color,t.globalAlpha=i,this.particleType==="rainbow"){const a=this.size*(this.lifetime/this.maxLifetime);t.beginPath(),t.arc(this.x,this.y,a,0,Math.PI*2),t.fill()}else t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill();t.globalAlpha=1}}}class M{constructor(t,i){this.x=t,this.y=i,this.lifetime=Math.random()*20+10,this.color=o(Math.random())}update(){this.lifetime--}draw(t){if(this.lifetime>0){const i=Math.random()*2+1;t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,i,0,Math.PI*2),t.fill()}}}class v{constructor(t,i,a,e,h){this.letter=t,this.targetX=i,this.targetY=a,this.canvas=e,this.letterWidth=h,this.letterSpacing=2,Math.random()<.5?(this.x=Math.random()<.5?-50:e.width+50,this.y=Math.random()*e.height):(this.x=Math.random()*e.width,this.y=Math.random()<.5?-50:e.height+50),this.revealed=!1,this.alpha=0,this.vx=0,this.vy=0}update(){const t=this.targetX-this.x,i=this.targetY-this.y;Math.sqrt(t*t+i*i)>1?(this.vx+=(t*.08-this.vx)*.1,this.vy+=(i*.08-this.vy)*.1,this.x+=this.vx,this.y+=this.vy):(this.revealed=!0,this.alpha=Math.min(255,this.alpha+5))}draw(t){this.alpha>0&&(t.font="72px Arial",t.fillStyle=o(Date.now()*.001),t.globalAlpha=this.alpha/255,t.textAlign="left",t.fillText(this.letter,this.x,this.y),t.globalAlpha=1)}isSettled(){return this.revealed&&this.alpha>=255}}const d={FADE_OUT:"FADE_OUT",FIREWORKS:"FIREWORKS"};function S(s,t,i){if(!t)return[];const a=72;s.font=`${a}px Arial`;const e=2,h=t.split("").reduce((n,l)=>n+s.measureText(l).width+e,0);let r=(i.width-h)/2;return t.split("").map(n=>{const l=s.measureText(n).width,g=new v(n,r,i.height/2-50,i,l);return r+=l+e,g})}function b(s,t){const i=w(s,t.height);s.fillStyle=i,s.fillRect(0,0,t.width,t.height)}function T(s,t,i){const a=Date.now(),e=Math.sin(a*.002)*3;for(let h=10;h>0;h-=2)s.font="160px Arial",s.fillStyle=`rgba(${h*5}, ${h*5}, ${h*10}, ${i/255/2})`,s.textAlign="center",s.fillText("2024",t.width/2+e,t.height/2);s.fillStyle=`rgba(255, 255, 255, ${i/255})`,s.fillText("2024",t.width/2,t.height/2)}function x(s,t){s.font="120px Arial",s.textAlign="center","2025".split("").forEach((i,a)=>{s.fillStyle=o(a*.25+Date.now()*3e-4),s.fillText(i,t.width/2-120+a*80,t.height/3)})}function A(s,t,i){const a=`Happy New Year, ${i}!`;s.font="80px Arial";for(let e=5;e>0;e--)s.fillStyle=`rgb(${e*20}, ${e*20}, ${e*20})`,s.fillText(a,t.width/2+(Math.random()*2-1),t.height*2/3+(Math.random()*2-1));s.fillStyle="#FFD700",s.fillText(a,t.width/2,t.height*2/3)}class E{constructor(t,i){this.canvas=t,this.ctx=t.getContext("2d"),this.config=i,this.resize(),this.init(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}init(){this.stars=Array.from({length:100},()=>new p(this.canvas)),this.fireworks=[],this.sparkles=[],this.state=d.FADE_OUT,this.alpha=255,this.startTime=Date.now(),this.secretRevealed=!1,this.showSecret=!1,this.messageStartTime=0,this.messageDuration=1e4,this.messageFadeDuration=2e3,this.secretLetters=S(this.ctx,this.config.secretMessage,this.canvas)}start(){this.animate()}animate(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),b(this.ctx,this.canvas),this.stars.forEach(t=>{t.update(),t.draw(this.ctx)}),this.state===d.FADE_OUT?(T(this.ctx,this.canvas,this.alpha),this.alpha=Math.max(0,this.alpha-3),this.alpha===0&&(this.state=d.FIREWORKS,this.startTime=Date.now(),this.showSecret=!0,this.messageStartTime=Date.now()+1e3)):this.state===d.FIREWORKS&&(this.updateFireworks(),x(this.ctx,this.canvas),A(this.ctx,this.canvas,this.config.name),this.updateSecretMessage()),requestAnimationFrame(()=>this.animate())}updateFireworks(){Math.random()<.1&&this.createFirework(),this.fireworks=this.fireworks.filter(t=>(t.update(),t.draw(this.ctx),t.lifetime>0)),this.sparkles=this.sparkles.filter(t=>(t.update(),t.draw(this.ctx),t.lifetime>0))}createFirework(){const t=Math.random()*(this.canvas.width-200)+100,i=Math.random()*(this.canvas.height-200)+100,a=Math.random()<.3?"rainbow":"normal";for(let e=0;e<70;e++)this.fireworks.push(new y(t,i,a,this.canvas));for(let e=0;e<20;e++)this.sparkles.push(new M(t+(Math.random()*60-30),i+(Math.random()*60-30),this.canvas))}updateSecretMessage(){if(this.showSecret&&Date.now()>=this.messageStartTime){const t=Date.now()-this.messageStartTime;if(t<this.messageDuration+this.messageFadeDuration){const i=t>this.messageDuration?255*(1-(t-this.messageDuration)/this.messageFadeDuration):255;let a=!0;this.secretLetters.forEach(e=>{e.update(),e.isSettled()||(a=!1),e.alpha>i&&(e.alpha=i),e.draw(this.ctx)}),a&&(this.secretRevealed=!0)}else this.showSecret=!1,this.secretRevealed=!1}}}function L(s,t){const i=[],a=s.captureStream(30),e=new MediaRecorder(a,{mimeType:"video/webm;codecs=vp9"});e.ondataavailable=h=>i.push(h.data),e.onstop=()=>{const h=new Blob(i,{type:"video/webm"}),r=URL.createObjectURL(h),n=document.createElement("a");n.href=r,n.download="new-year-animation.webm",n.click(),URL.revokeObjectURL(r)},t.addEventListener("click",()=>{e.state==="recording"?(e.stop(),t.textContent="Download Animation"):(i.length=0,e.start(),t.textContent="Stop Recording")})}const c=document.getElementById("canvas"),R=document.getElementById("name"),D=document.getElementById("secretMessage"),f=document.getElementById("startBtn"),m=document.getElementById("downloadBtn");let u;f.addEventListener("click",()=>{const s={name:R.value||"Friend",secretMessage:D.value||""};u=new E(c,s),u.start(),f.classList.add("hidden"),m.classList.remove("hidden"),L(c,m)});
